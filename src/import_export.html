<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="theme-color" content="#007aff">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title data-i18n-key="import_export_title">🔄 Import/Export</title>
  <link rel="icon" type="image/png" href="./icons/icon-192x192.png">
  <link rel="apple-touch-icon" href="./icons/icon-192x192.png">
  <!-- Link to the PWA manifest -->
  <!--
  <script src="js/script.js"></script>
  <link rel="manifest" href="./manifest.json">
  -->
  <link rel="stylesheet" href="./css/shared.css">
  <link rel="stylesheet" href="./css/import_export.css">

  <!--
    NOTE: The inline role-checking script has been removed.
    This logic is now handled more robustly inside js/main.js
  -->
</head>

<body class="loading-translations">
  

  <nav class="main-nav" aria-label="Main navigation">
    <div class="nav-links">
      <a href="./orders.html" class="nav-link" aria-label="View Orders">
        🛒<span class="nav-text" data-i18n-key="nav_orders">Orders</span>
      </a>
      <a href="./products.html" class="nav-link" aria-label="View Products">
        📦<span class="nav-text" data-i18n-key="nav_products">Products</span>
      </a>
      <a href="./borrowers.html" class="nav-link" aria-label="View Borrowers">
        👥<span class="nav-text" data-i18n-key="nav_borrowers">Borrowers</span>
      </a>
      <a href="./statistics.html" class="nav-link" aria-label="View Statistics">
        📊<span class="nav-text" data-i18n-key="nav_statistics">Statistics</span>
      </a>
      <a href="./import_export.html" class="nav-link active" aria-label="Import/Export Data" aria-current="page">
        🔄<span class="nav-text" data-i18n-key="nav_import_export">Import/Export</span>
      </a>
    </div>
  </nav>

  <main>
    <header class="page-header">
      <h1 data-i18n-key="google_drive_manager_title">Google Drive Manager</h1>
    </header>
    
    <div class="page-controls-wrapper">
      <!-- PWA Install Button card. The JS will show this only if the app isn't installed. -->
      <div class="card" id="pwa-install-card" style="display: none;">
          <h2 data-i18n-key="app_install_title">📱 Application</h2>
          <p data-i18n-key="app_install_desc">Install this application on your device for a faster, offline experience that feels like a native app.</p>
          <button id="install-pwa-btn">
              <span data-i18n-key="btn_install_app">Install Local Ledger</span>
          </button>
      </div>

      <!-- Language Selector -->
      <div id="language-switcher-wrapper" class="language-select-wrapper">
        <span id="lang-display" class="lang-display-text">🌐 EN</span>
        <select id="lang-select" aria-label="Select language">
          <option value="en">English</option>
          <option value="fr">Français</option>
          <option value="ar">العربية</option>
        </select>
      </div>
    </div>

    <div id="status-area" role="status" aria-live="polite"></div>

    <div class="card">
      <h2 data-i18n-key="config_title">⚙️ Configuration</h2>
      <p data-i18n-key="config_desc">Enter your Google Drive Client ID. This is required for authentication.</p>
      <div class="control-group">
        <label for="google-client-id" class="visually-hidden">Google Client ID</label>
        <input type="text" id="google-client-id" data-i18n-key="config_placeholder" placeholder="Enter your Google Client ID here...">
        <button id="save-client-id-btn">💾<span class="button-text" data-i18n-key="config_button_text">Save Client ID</span></button>
      </div>
    </div>

    <div class="card">
      <h2 data-i18n-key="auth_title">🔑 Authentication</h2>
      <p data-i18n-key="auth_desc">Connect your Google account to enable cloud import and export.</p>
      <div id="auth-status" data-i18n-key="auth_status_awaiting" aria-live="polite">Awaiting sign-in...</div>
    </div>

    <div class="card">
      <h2 data-i18n-key="export_title">⬆️ Export to Cloud</h2>
      <p data-i18n-key="export_desc">Save the current local database to your Google Drive.</p>
      <button id="export-db-to-drive-btn">⬆️<span class="button-text" data-i18n-key="export_button_text">Export Database</span></button>
    </div>

    <div class="card">
      <h2 data-i18n-key="import_title">⬇️ Import from Cloud</h2>
      <p>
        <span data-i18n-key="import_desc">Replace the local database with a file from your Google Drive.</span>
        <strong data-i1is-a-fully-functional-and-installable-progressive-web-app-key="import_desc_warning">This will overwrite local data.</strong>
      </p>
      <div class="control-group">
        <input type="text" id="drive-file-id" data-i18n-key="import_placeholder" placeholder="Last exported ID will appear here...">
        <button id="import-db-from-drive-btn">⬇️<span class="button-text" data-i18n-key="import_button_text">Import Database</span></button>
      </div>
    </div>

    <div class="card">
      <h2 data-i18n-key="viewer_title">📄 Database Viewer</h2>
      <p data-i18n-key="viewer_desc">Inspect the contents of the tables in the currently loaded database.</p>
      <div class="control-group">
        <select id="table-selector">
          <option value="" data-i18n-key="viewer_select_table">Select a table...</option>
        </select>
        <label for="row-limit" data-i18n-key="viewer_limit_label">Limit:</label>
        <input type="number" id="row-limit" value="10" min="1" max="1000">
        <button id="refresh-table-btn">🔄<span class="button-text" data-i18n-key="viewer_button_text">Refresh View</span></button>
      </div>
      <pre id="table-output" data-i18n-key="viewer_no_table" aria-live="polite">No table selected</pre>
    </div>

    <div class="card">
      <h2 data-i18n-key="info_title">📊 Database Info</h2>
      <pre id="db-info" data-i18n-key="info_no_db" aria-live="polite">No database loaded</pre>
    </div>

    <div class="card danger-zone">
      <h2 data-i18n-key="danger_title">🧪 Danger Zone</h2>
      <p data-i18n-key="danger_desc">These actions can result in data loss. Use with caution.</p>
      <div class="control-group">
        <button id="init-sample-data-btn">🧪<span class="button-text" data-i18n-key="danger_button_sample_text">Initialize Sample Data</span></button>
           <!-- ▼▼▼ ADD THIS NEW BUTTON ▼▼▼ -->
    <button id="prune-history-btn" class="warning-btn">✂️<span class="button-text" data-i18n-key="danger_button_prune_text">Prune Old History</span></button>
    <!-- ▲▲▲ END OF NEW BUTTON ▲▲▲ -->
        <button id="delete-all-data-btn" class="danger-btn">🗑️<span class="button-text" data-i18n-key="danger_button_delete_text">Delete All Data</span></button>
        
      </div>
    </div>
  </main>
  
  <!-- External Libraries & Main Application Logic -->
  <script src="./libs/sql-wasm.js"></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script type="module" src="./js/main.js"></script>
  <script type="module" src="./js/import_export.js"></script>

</body>
</html>